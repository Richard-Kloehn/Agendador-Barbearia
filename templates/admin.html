<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Barbearia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        
        .sidebar-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .sidebar-item:hover {
            background: rgba(218, 165, 32, 0.1);
            transform: translateX(5px);
        }
        
        .sidebar-item.active {
            background: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
            color: white;
        }
        
        .stat-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg hidden md:block">
            <div class="p-6 bg-gradient-to-r from-gray-900 to-gray-800">
                <h1 class="text-white text-2xl font-bold">
                    <i class="fas fa-cut mr-2" style="color: #daa520;"></i>Admin
                </h1>
                <p class="text-yellow-200 text-sm">Painel de Controle</p>
            </div>
            
            <nav class="mt-6">
                <div class="sidebar-item active px-6 py-3" onclick="mostrarSecao('dashboard')">
                    <i class="fas fa-chart-line w-5 mr-3"></i>Dashboard
                </div>
                <div class="sidebar-item px-6 py-3" onclick="mostrarSecao('agendamentos')">
                    <i class="fas fa-calendar-alt w-5 mr-3"></i>Agendamentos
                </div>
                <div class="sidebar-item px-6 py-3" onclick="mostrarSecao('barbeiros')">
                    <i class="fas fa-cut w-5 mr-3"></i>Barbeiros
                </div>
                <div class="sidebar-item px-6 py-3" onclick="mostrarSecao('servicos')">
                    <i class="fas fa-scissors w-5 mr-3"></i>Serviços
                </div>
                <div class="sidebar-item px-6 py-3" onclick="mostrarSecao('configuracoes')">
                    <i class="fas fa-cog w-5 mr-3"></i>Configurações
                </div>
                <div class="sidebar-item px-6 py-3" onclick="window.location.href='/'">
                    <i class="fas fa-home w-5 mr-3"></i>Site Principal
                </div>
                <div class="sidebar-item px-6 py-3 text-red-600" onclick="window.location.href='/admin-logout'">
                    <i class="fas fa-sign-out-alt w-5 mr-3"></i>Sair
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm">
                <div class="px-6 py-4 flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800" id="tituloSecao">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-600" id="dataHoje"></span>
                        <button onclick="atualizarDados()" class="bg-gradient-to-r from-yellow-600 to-yellow-700 text-white px-4 py-2 rounded-lg hover:shadow-lg transition">
                            <i class="fas fa-sync-alt mr-2"></i>Atualizar
                        </button>
                    </div>
                </div>
            </header>

            <div class="p-6">
                <!-- Dashboard Section -->
                <section id="secao-dashboard" class="secao">
                    <!-- Estatísticas -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm font-semibold">Total de Agendamentos</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2" id="statTotal">0</p>
                                </div>
                                <i class="fas fa-calendar-check text-4xl" style="color: #daa520;"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm font-semibold">Hoje</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2" id="statHoje">0</p>
                                </div>
                                <i class="fas fa-clock text-4xl text-blue-600"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm font-semibold">Confirmados</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2" id="statConfirmados">0</p>
                                </div>
                                <i class="fas fa-check-circle text-4xl text-green-600"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm font-semibold">Pendentes</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2" id="statPendentes">0</p>
                                </div>
                                <i class="fas fa-hourglass-half text-4xl text-yellow-600"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Próximos Agendamentos -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-calendar-day mr-2" style="color: #daa520;"></i>Agendamentos de Hoje
                        </h3>
                        <div id="agendamentosHoje" class="space-y-3"></div>
                    </div>
                </section>

                <!-- Agendamentos Section -->
                <section id="secao-agendamentos" class="secao hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <!-- Filtros -->
                        <div class="mb-6 flex flex-wrap gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Data</label>
                                <input type="date" id="filtroData" onchange="carregarAgendamentos()"
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-yellow-600">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                                <select id="filtroStatus" onchange="carregarAgendamentos()"
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-yellow-600">
                                    <option value="">Todos</option>
                                    <option value="pendente">Pendente</option>
                                    <option value="confirmado">Confirmado</option>
                                    <option value="cancelado">Cancelado</option>
                                    <option value="concluido">Concluído</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button onclick="limparFiltros()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                    Limpar Filtros
                                </button>
                            </div>
                        </div>

                        <!-- Tabela de Agendamentos -->
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Cliente</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Telefone</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Data/Hora</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaAgendamentos">
                                    <!-- Preenchido dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Barbeiros Section -->
                <section id="secao-barbeiros" class="secao hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-cut mr-2" style="color: #daa520;"></i>Gerenciar Barbeiros
                        </h3>
                        <button onclick="abrirModalBarbeiro()" class="bg-gradient-to-r from-yellow-600 to-yellow-700 text-white px-6 py-3 rounded-lg hover:shadow-lg transition">
                            <i class="fas fa-plus mr-2"></i>Novo Barbeiro
                        </button>
                    </div>

                    <!-- Lista de Barbeiros -->
                    <div id="listaBarbeiros" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Barbeiros serão inseridos aqui -->
                    </div>
                </section>

                <!-- Serviços Section -->
                <section id="secao-servicos" class="secao hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-scissors mr-2" style="color: #daa520;"></i>Gerenciar Serviços
                        </h3>
                        <button onclick="abrirModalServico()" class="bg-gradient-to-r from-yellow-600 to-yellow-700 text-white px-6 py-3 rounded-lg hover:shadow-lg transition">
                            <i class="fas fa-plus mr-2"></i>Novo Serviço
                        </button>
                    </div>

                    <!-- Lista de Serviços -->
                    <div id="listaServicos" class="space-y-4">
                        <!-- Serviços serão inseridos aqui -->
                    </div>
                </section>

                <!-- Configurações Section -->
                <section id="secao-configuracoes" class="secao hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Configurações da Barbearia -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">Configurações da Barbearia</h3>
                            
                            <form id="formConfig" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nome da Barbearia</label>
                                    <input type="text" id="configNome" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Horário Abertura</label>
                                        <input type="time" id="configAbertura" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Horário Fechamento</label>
                                        <input type="time" id="configFechamento" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Almoço Início</label>
                                        <input type="time" id="configAlmocoInicio" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Almoço Fim</label>
                                        <input type="time" id="configAlmocoFim" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                </div>
                                
                                <button type="button" onclick="salvarConfiguracao()" 
                                    class="w-full bg-gradient-to-r from-yellow-600 to-yellow-700 text-white font-bold py-3 rounded-lg hover:shadow-lg transition">
                                    <i class="fas fa-save mr-2"></i>Salvar Configurações
                                </button>
                            </form>
                        </div>
                        
                        <!-- Horários Especiais -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Horários Especiais</h3>
                            <p class="text-gray-600 text-sm mb-4">Configure horários diferenciados para datas específicas (feriados, eventos, etc)</p>
                            
                            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                                <h4 class="font-semibold text-gray-700 mb-3">Adicionar Horário Especial</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Data</label>
                                        <input type="date" id="horarioEspecialData" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Descrição</label>
                                        <input type="text" id="horarioEspecialDesc" placeholder="Ex: Feriado" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Abertura</label>
                                            <input type="time" id="horarioEspecialAbertura" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Fechamento</label>
                                            <input type="time" id="horarioEspecialFechamento" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Almoço Início</label>
                                            <input type="time" id="horarioEspecialAlmocoInicio" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Almoço Fim</label>
                                            <input type="time" id="horarioEspecialAlmocoFim" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        </div>
                                    </div>
                                </div>
                                <button type="button" onclick="adicionarHorarioEspecial()" 
                                    class="mt-4 w-full bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-plus mr-2"></i>Adicionar
                                </button>
                            </div>
                            
                            <div id="listaHorariosEspeciais" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Horários especiais serão listados aqui -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            const hoje = new Date();
            document.getElementById('dataHoje').textContent = hoje.toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            atualizarDados();
            carregarHorariosEspeciais();
        });

        function mostrarSecao(secao) {
            // Atualizar sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.sidebar-item').classList.add('active');
            
            // Mostrar seção
            document.querySelectorAll('.secao').forEach(s => s.classList.add('hidden'));
            document.getElementById('secao-' + secao).classList.remove('hidden');
            
            // Atualizar título
            const titulos = {
                'dashboard': 'Dashboard',
                'agendamentos': 'Gerenciar Agendamentos',
                'barbeiros': 'Gerenciar Barbeiros',
                'servicos': 'Gerenciar Serviços',
                'configuracoes': 'Configurações'
            };
            document.getElementById('tituloSecao').textContent = titulos[secao];
            
            // Carregar dados da seção
            if (secao === 'agendamentos') {
                carregarAgendamentos();
            } else if (secao === 'barbeiros') {
                carregarBarbeiros();
            } else if (secao === 'servicos') {
                carregarServicos();
            } else if (secao === 'configuracoes') {
                carregarConfiguracao();
            }
        }

        async function atualizarDados() {
            await carregarEstatisticas();
            await carregarAgendamentosHoje();
        }

        async function carregarEstatisticas() {
            try {
                const response = await fetch('/admin/estatisticas');
                const stats = await response.json();
                
                document.getElementById('statTotal').textContent = stats.total || 0;
                document.getElementById('statHoje').textContent = stats.hoje || 0;
                document.getElementById('statConfirmados').textContent = stats.confirmados || 0;
                document.getElementById('statPendentes').textContent = stats.pendentes || 0;
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
            }
        }

        async function carregarAgendamentosHoje() {
            const hoje = new Date().toISOString().split('T')[0];
            try {
                const response = await fetch(`/admin/agendamentos?data=${hoje}`);
                const dados = await response.json();
                
                const container = document.getElementById('agendamentosHoje');
                container.innerHTML = '';
                
                if (dados.agendamentos && dados.agendamentos.length > 0) {
                    dados.agendamentos.forEach(ag => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                        div.innerHTML = `
                            <div>
                                <p class="font-semibold text-gray-800">${ag.nome_cliente}</p>
                                <p class="text-sm text-gray-600">${new Date(ag.data_hora).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</p>
                            </div>
                            <span class="status-badge ${getStatusColor(ag.status)}">${getStatusLabel(ag.status)}</span>
                        `;
                        container.appendChild(div);
                    });
                } else {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum agendamento para hoje</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar agendamentos:', error);
            }
        }

        async function carregarAgendamentos() {
            const data = document.getElementById('filtroData').value;
            const status = document.getElementById('filtroStatus').value;
            
            let url = '/admin/agendamentos?';
            if (data) url += `data=${data}&`;
            if (status) url += `status=${status}`;
            
            try {
                const response = await fetch(url);
                const dados = await response.json();
                
                const tbody = document.getElementById('tabelaAgendamentos');
                tbody.innerHTML = '';
                
                if (dados.agendamentos && dados.agendamentos.length > 0) {
                    dados.agendamentos.forEach(ag => {
                        const tr = document.createElement('tr');
                        tr.className = 'border-b hover:bg-gray-50';
                        tr.innerHTML = `
                            <td class="px-4 py-3">${ag.nome_cliente}</td>
                            <td class="px-4 py-3">${formatarTelefone(ag.telefone)}</td>
                            <td class="px-4 py-3">${formatarDataHora(ag.data_hora)}</td>
                            <td class="px-4 py-3">
                                <span class="status-badge ${getStatusColor(ag.status)}">${getStatusLabel(ag.status)}</span>
                            </td>
                            <td class="px-4 py-3">
                                <select onchange="alterarStatus(${ag.id}, this.value)" class="text-sm px-2 py-1 border rounded">
                                    <option value="">Alterar...</option>
                                    <option value="confirmado">Confirmar</option>
                                    <option value="concluido">Concluir</option>
                                    <option value="cancelado">Cancelar</option>
                                </select>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Nenhum agendamento encontrado</td></tr>';
                }
            } catch (error) {
                console.error('Erro ao carregar agendamentos:', error);
            }
        }

        async function alterarStatus(id, novoStatus) {
            if (!novoStatus) return;
            
            try {
                const response = await fetch(`/admin/agendamentos/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: novoStatus })
                });
                
                if (response.ok) {
                    carregarAgendamentos();
                    atualizarDados();
                }
            } catch (error) {
                alert('Erro ao atualizar status');
            }
        }

        async function carregarConfiguracao() {
            try {
                const response = await fetch('/admin/configuracao');
                const config = await response.json();
                
                document.getElementById('configNome').value = config.nome_barbearia;
                document.getElementById('configAbertura').value = config.horario_abertura;
                document.getElementById('configFechamento').value = config.horario_fechamento;
                document.getElementById('configAlmocoInicio').value = config.intervalo_almoco_inicio || '';
                document.getElementById('configAlmocoFim').value = config.intervalo_almoco_fim || '';
            } catch (error) {
                console.error('Erro ao carregar configuração:', error);
            }
        }

        async function salvarConfiguracao() {
            const config = {
                nome_barbearia: document.getElementById('configNome').value,
                horario_abertura: document.getElementById('configAbertura').value,
                horario_fechamento: document.getElementById('configFechamento').value,
                duracao_atendimento: 30,
                intervalo_almoco_inicio: document.getElementById('configAlmocoInicio').value,
                intervalo_almoco_fim: document.getElementById('configAlmocoFim').value
            };
            
            try {
                const response = await fetch('/admin/configuracao', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    alert('Configuração salva com sucesso!');
                }
            } catch (error) {
                alert('Erro ao salvar configuração');
            }
        }

        async function carregarHorariosEspeciais() {
            try {
                const response = await fetch('/admin/horarios-especiais');
                const dados = await response.json();
                
                const lista = document.getElementById('listaHorariosEspeciais');
                lista.innerHTML = '';
                
                if (dados.horarios_especiais && dados.horarios_especiais.length > 0) {
                    dados.horarios_especiais.forEach(h => {
                        const div = document.createElement('div');
                        div.className = 'bg-white border border-gray-200 p-4 rounded-lg flex items-center justify-between';
                        div.innerHTML = `
                            <div>
                                <p class="font-semibold text-gray-800">${new Date(h.data + 'T00:00:00').toLocaleDateString('pt-BR')} - ${h.descricao || 'Sem descrição'}</p>
                                <p class="text-sm text-gray-600">
                                    <i class="fas fa-clock mr-1"></i>${h.horario_abertura} às ${h.horario_fechamento}
                                    ${h.intervalo_almoco_inicio ? ` | Almoço: ${h.intervalo_almoco_inicio} - ${h.intervalo_almoco_fim}` : ''}
                                </p>
                            </div>
                            <button onclick="deletarHorarioEspecial(${h.id})" 
                                class="text-red-600 hover:text-red-800 font-semibold">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        `;
                        lista.appendChild(div);
                    });
                } else {
                    lista.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum horário especial configurado</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar horários especiais:', error);
            }
        }

        async function adicionarHorarioEspecial() {
            const data = document.getElementById('horarioEspecialData').value;
            const descricao = document.getElementById('horarioEspecialDesc').value;
            const abertura = document.getElementById('horarioEspecialAbertura').value;
            const fechamento = document.getElementById('horarioEspecialFechamento').value;
            const almocoInicio = document.getElementById('horarioEspecialAlmocoInicio').value;
            const almocoFim = document.getElementById('horarioEspecialAlmocoFim').value;
            
            if (!data || !abertura || !fechamento) {
                alert('Preencha data, abertura e fechamento');
                return;
            }
            
            try {
                const response = await fetch('/admin/horarios-especiais', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        data,
                        descricao,
                        horario_abertura: abertura,
                        horario_fechamento: fechamento,
                        intervalo_almoco_inicio: almocoInicio || null,
                        intervalo_almoco_fim: almocoFim || null
                    })
                });
                
                if (response.ok) {
                    alert('Horário especial adicionado!');
                    // Limpar campos
                    document.getElementById('horarioEspecialData').value = '';
                    document.getElementById('horarioEspecialDesc').value = '';
                    document.getElementById('horarioEspecialAbertura').value = '';
                    document.getElementById('horarioEspecialFechamento').value = '';
                    document.getElementById('horarioEspecialAlmocoInicio').value = '';
                    document.getElementById('horarioEspecialAlmocoFim').value = '';
                    carregarHorariosEspeciais();
                } else {
                    const erro = await response.json();
                    alert(erro.erro || 'Erro ao adicionar horário especial');
                }
            } catch (error) {
                alert('Erro ao adicionar horário especial');
            }
        }

        async function deletarHorarioEspecial(id) {
            if (!confirm('Deseja remover este horário especial?')) return;
            
            try {
                const response = await fetch(`/admin/horarios-especiais/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Horário especial removido!');
                    carregarHorariosEspeciais();
                } else {
                    alert('Erro ao remover horário especial');
                }
            } catch (error) {
                alert('Erro ao remover horário especial');
            }
        }

        function limparFiltros() {
            document.getElementById('filtroData').value = '';
            document.getElementById('filtroStatus').value = '';
            carregarAgendamentos();
        }

        // Funções auxiliares
        function getStatusColor(status) {
            const cores = {
                'pendente': 'bg-yellow-100 text-yellow-800',
                'confirmado': 'bg-green-100 text-green-800',
                'cancelado': 'bg-red-100 text-red-800',
                'concluido': 'bg-blue-100 text-blue-800'
            };
            return cores[status] || 'bg-gray-100 text-gray-800';
        }

        function getStatusLabel(status) {
            const labels = {
                'pendente': 'Pendente',
                'confirmado': 'Confirmado',
                'cancelado': 'Cancelado',
                'concluido': 'Concluído'
            };
            return labels[status] || status;
        }

        function formatarTelefone(telefone) {
            if (!telefone) return '';
            const tel = telefone.replace(/\D/g, '');
            if (tel.length === 11) {
                return `(${tel.substr(0,2)}) ${tel.substr(2,5)}-${tel.substr(7)}`;
            }
            return telefone;
        }

        function formatarDataHora(dataHora) {
            const data = new Date(dataHora);
            return data.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>

    <!-- Modal Barbeiro -->
    <div id="modalBarbeiro" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="tituloModalBarbeiro">Novo Barbeiro</h3>
                <button onclick="fecharModalBarbeiro()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <form id="formBarbeiro" class="space-y-6">
                <input type="hidden" id="barbeiroId">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nome do Barbeiro</label>
                    <input type="text" id="barbeiroNome" required
                        class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">URL da Foto</label>
                    <input type="url" id="barbeiroFoto" placeholder="https://exemplo.com/foto.jpg"
                        class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition">
                    <p class="text-xs text-gray-500 mt-1">Cole a URL de uma imagem online ou deixe em branco para usar placeholder</p>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ordem de Exibição</label>
                    <input type="number" id="barbeiroOrdem" value="1" min="1"
                        class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition">
                </div>

                <div>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="barbeiroAtivo" checked class="w-5 h-5 text-yellow-600 rounded">
                        <span class="ml-3 text-gray-700 font-semibold">Barbeiro Ativo</span>
                    </label>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Serviços que oferece</label>
                    <div id="servicosDisponiveis" class="space-y-2 max-h-48 overflow-y-auto border-2 border-gray-200 rounded-lg p-4">
                        <!-- Checkboxes de serviços serão inseridos aqui -->
                    </div>
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-yellow-600 to-yellow-700 text-white font-bold py-3 rounded-lg hover:shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>Salvar
                    </button>
                    <button type="button" onclick="fecharModalBarbeiro()" class="flex-1 bg-gray-300 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-400 transition">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Serviço -->
    <div id="modalServico" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="tituloModalServico">Novo Serviço</h3>
                <button onclick="fecharModalServico()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <form id="formServico" class="space-y-6">
                <input type="hidden" id="servicoId">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nome do Serviço</label>
                    <input type="text" id="servicoNome" required
                        class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Descrição</label>
                    <textarea id="servicoDescricao" rows="3"
                        class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Duração (minutos)</label>
                        <input type="number" id="servicoDuracao" required min="5" step="5" value="30"
                            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Preço (R$)</label>
                        <input type="number" id="servicoPreco" required min="0" step="0.01" value="45.00"
                            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-yellow-600 focus:outline-none transition">
                    </div>
                </div>

                <div>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="servicoAtivo" checked class="w-5 h-5 text-yellow-600 rounded">
                        <span class="ml-3 text-gray-700 font-semibold">Serviço Ativo</span>
                    </label>
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-yellow-600 to-yellow-700 text-white font-bold py-3 rounded-lg hover:shadow-lg transition">
                        <i class="fas fa-save mr-2"></i>Salvar
                    </button>
                    <button type="button" onclick="fecharModalServico()" class="flex-1 bg-gray-300 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-400 transition">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========== BARBEIROS ==========
        let servicosGlobal = [];

        async function carregarBarbeiros() {
            try {
                const response = await fetch('/admin/barbeiros');
                const data = await response.json();
                
                const container = document.getElementById('listaBarbeiros');
                container.innerHTML = '';
                
                if (data.barbeiros && data.barbeiros.length > 0) {
                    data.barbeiros.forEach(barbeiro => {
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition';
                        card.innerHTML = `
                            <div class="flex flex-col items-center text-center">
                                <img src="${barbeiro.foto_url || 'https://via.placeholder.com/150'}" 
                                     alt="${barbeiro.nome}" 
                                     class="w-24 h-24 rounded-full object-cover border-4 border-yellow-200 mb-4">
                                <h4 class="text-xl font-bold text-gray-800 mb-2">${barbeiro.nome}</h4>
                                <span class="text-sm ${barbeiro.ativo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-3 py-1 rounded-full mb-3">
                                    ${barbeiro.ativo ? 'Ativo' : 'Inativo'}
                                </span>
                                <p class="text-sm text-gray-600 mb-4">
                                    <i class="fas fa-briefcase mr-1"></i>${barbeiro.servicos ? barbeiro.servicos.length : 0} serviços
                                </p>
                                <div class="flex space-x-2 w-full">
                                    <button onclick="editarBarbeiro(${barbeiro.id})" 
                                        class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deletarBarbeiro(${barbeiro.id}, '${barbeiro.nome}')" 
                                        class="flex-1 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = '<p class="text-gray-500 text-center col-span-full">Nenhum barbeiro cadastrado</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar barbeiros:', error);
                alert('Erro ao carregar barbeiros');
            }
        }

        async function carregarServicosParaSelecao() {
            try {
                const response = await fetch('/admin/servicos');
                const data = await response.json();
                servicosGlobal = data.servicos || [];
                
                const container = document.getElementById('servicosDisponiveis');
                container.innerHTML = '';
                
                servicosGlobal.forEach(servico => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center';
                    div.innerHTML = `
                        <input type="checkbox" id="servico_${servico.id}" value="${servico.id}" 
                            class="w-4 h-4 text-yellow-600 rounded">
                        <label for="servico_${servico.id}" class="ml-2 text-sm text-gray-700">
                            ${servico.nome} (R$ ${servico.preco.toFixed(2)} - ${servico.duracao}min)
                        </label>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Erro ao carregar serviços:', error);
            }
        }

        async function abrirModalBarbeiro(barbeiroId = null) {
            await carregarServicosParaSelecao();
            
            if (barbeiroId) {
                document.getElementById('tituloModalBarbeiro').textContent = 'Editar Barbeiro';
                // Carregar dados do barbeiro
                try {
                    const response = await fetch('/admin/barbeiros');
                    const data = await response.json();
                    const barbeiro = data.barbeiros.find(b => b.id === barbeiroId);
                    
                    if (barbeiro) {
                        document.getElementById('barbeiroId').value = barbeiro.id;
                        document.getElementById('barbeiroNome').value = barbeiro.nome;
                        document.getElementById('barbeiroFoto').value = barbeiro.foto_url || '';
                        document.getElementById('barbeiroOrdem').value = barbeiro.ordem;
                        document.getElementById('barbeiroAtivo').checked = barbeiro.ativo;
                        
                        // Marcar serviços
                        const servicosIds = barbeiro.servicos ? barbeiro.servicos.map(s => s.id) : [];
                        servicosGlobal.forEach(servico => {
                            const checkbox = document.getElementById(`servico_${servico.id}`);
                            if (checkbox) {
                                checkbox.checked = servicosIds.includes(servico.id);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Erro ao carregar barbeiro:', error);
                }
            } else {
                document.getElementById('tituloModalBarbeiro').textContent = 'Novo Barbeiro';
                document.getElementById('formBarbeiro').reset();
                document.getElementById('barbeiroId').value = '';
                // Marcar todos os serviços por padrão
                servicosGlobal.forEach(servico => {
                    const checkbox = document.getElementById(`servico_${servico.id}`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            document.getElementById('modalBarbeiro').classList.remove('hidden');
        }

        function fecharModalBarbeiro() {
            document.getElementById('modalBarbeiro').classList.add('hidden');
            document.getElementById('formBarbeiro').reset();
        }

        document.getElementById('formBarbeiro').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const barbeiroId = document.getElementById('barbeiroId').value;
            const servicosSelecionados = [];
            servicosGlobal.forEach(servico => {
                const checkbox = document.getElementById(`servico_${servico.id}`);
                if (checkbox && checkbox.checked) {
                    servicosSelecionados.push(servico.id);
                }
            });
            
            const dados = {
                nome: document.getElementById('barbeiroNome').value,
                foto_url: document.getElementById('barbeiroFoto').value || 'https://via.placeholder.com/150',
                ordem: parseInt(document.getElementById('barbeiroOrdem').value),
                ativo: document.getElementById('barbeiroAtivo').checked,
                servicos_ids: servicosSelecionados
            };
            
            try {
                const url = barbeiroId ? `/admin/barbeiros/${barbeiroId}` : '/admin/barbeiros';
                const method = barbeiroId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });
                
                if (response.ok) {
                    alert(barbeiroId ? 'Barbeiro atualizado!' : 'Barbeiro criado!');
                    fecharModalBarbeiro();
                    carregarBarbeiros();
                } else {
                    const erro = await response.json();
                    alert(erro.erro || 'Erro ao salvar barbeiro');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar barbeiro');
            }
        });

        async function editarBarbeiro(id) {
            await abrirModalBarbeiro(id);
        }

        async function deletarBarbeiro(id, nome) {
            if (!confirm(`Tem certeza que deseja deletar o barbeiro "${nome}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/barbeiros/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Barbeiro deletado!');
                    carregarBarbeiros();
                } else {
                    const erro = await response.json();
                    alert(erro.erro || 'Erro ao deletar barbeiro');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao deletar barbeiro');
            }
        }

        // ========== SERVIÇOS ==========
        async function carregarServicos() {
            try {
                const response = await fetch('/admin/servicos');
                const data = await response.json();
                
                const container = document.getElementById('listaServicos');
                container.innerHTML = '';
                
                if (data.servicos && data.servicos.length > 0) {
                    data.servicos.forEach(servico => {
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition';
                        card.innerHTML = `
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <i class="fas fa-scissors text-2xl text-yellow-600 mr-3"></i>
                                        <h4 class="text-xl font-bold text-gray-800">${servico.nome}</h4>
                                        <span class="ml-3 text-sm ${servico.ativo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-3 py-1 rounded-full">
                                            ${servico.ativo ? 'Ativo' : 'Inativo'}
                                        </span>
                                    </div>
                                    <p class="text-gray-600 mb-3">${servico.descricao || 'Sem descrição'}</p>
                                    <div class="flex space-x-6 text-sm text-gray-600">
                                        <span><i class="fas fa-clock text-yellow-600 mr-1"></i>${servico.duracao} minutos</span>
                                        <span class="text-lg font-bold text-yellow-600">R$ ${servico.preco.toFixed(2)}</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2 ml-4">
                                    <button onclick="editarServico(${servico.id})" 
                                        class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deletarServico(${servico.id}, '${servico.nome}')" 
                                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = '<p class="text-gray-500 text-center">Nenhum serviço cadastrado</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar serviços:', error);
                alert('Erro ao carregar serviços');
            }
        }

        async function abrirModalServico(servicoId = null) {
            if (servicoId) {
                document.getElementById('tituloModalServico').textContent = 'Editar Serviço';
                // Carregar dados do serviço
                try {
                    const response = await fetch('/admin/servicos');
                    const data = await response.json();
                    const servico = data.servicos.find(s => s.id === servicoId);
                    
                    if (servico) {
                        document.getElementById('servicoId').value = servico.id;
                        document.getElementById('servicoNome').value = servico.nome;
                        document.getElementById('servicoDescricao').value = servico.descricao || '';
                        document.getElementById('servicoDuracao').value = servico.duracao;
                        document.getElementById('servicoPreco').value = servico.preco;
                        document.getElementById('servicoAtivo').checked = servico.ativo;
                    }
                } catch (error) {
                    console.error('Erro ao carregar serviço:', error);
                }
            } else {
                document.getElementById('tituloModalServico').textContent = 'Novo Serviço';
                document.getElementById('formServico').reset();
                document.getElementById('servicoId').value = '';
            }
            
            document.getElementById('modalServico').classList.remove('hidden');
        }

        function fecharModalServico() {
            document.getElementById('modalServico').classList.add('hidden');
            document.getElementById('formServico').reset();
        }

        document.getElementById('formServico').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const servicoId = document.getElementById('servicoId').value;
            
            const dados = {
                nome: document.getElementById('servicoNome').value,
                descricao: document.getElementById('servicoDescricao').value,
                duracao: parseInt(document.getElementById('servicoDuracao').value),
                preco: parseFloat(document.getElementById('servicoPreco').value),
                ativo: document.getElementById('servicoAtivo').checked
            };
            
            try {
                const url = servicoId ? `/admin/servicos/${servicoId}` : '/admin/servicos';
                const method = servicoId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });
                
                if (response.ok) {
                    alert(servicoId ? 'Serviço atualizado!' : 'Serviço criado!');
                    fecharModalServico();
                    carregarServicos();
                } else {
                    const erro = await response.json();
                    alert(erro.erro || 'Erro ao salvar serviço');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar serviço');
            }
        });

        async function editarServico(id) {
            await abrirModalServico(id);
        }

        async function deletarServico(id, nome) {
            if (!confirm(`Tem certeza que deseja deletar o serviço "${nome}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/servicos/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Serviço deletado!');
                    carregarServicos();
                } else {
                    const erro = await response.json();
                    alert(erro.erro || 'Erro ao deletar serviço');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao deletar serviço');
            }
        }
    </script>
</body>
</html>

